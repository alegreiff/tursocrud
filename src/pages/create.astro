---
import MainLayout from '../components/MainLayout.astro';
import { createUser } from '../lib/crud';

let errorMessage = '';

if (Astro.request.method === 'POST') {
  try {
    const formData = await Astro.request.formData();
    const name = formData.get('name')?.toString() || '';
    const email = formData.get('email')?.toString() || '';

    if (!name || !email) {
      errorMessage = 'Name and email are required';
    } else {
      await createUser(name, email);
      return Astro.redirect('/');
    }
  } catch (error) {
    errorMessage = 'Failed to create user: ' + (error instanceof Error ? error.message : 'Unknown error');
  }
}
---


  <MainLayout>
    <h1>Create New User</h1>
  
  {errorMessage && (
    <div style="color: red;">{errorMessage}</div>
  )}

  <form method="POST">
    <div>
      <label for="name">Name:</label>
      <input 
        type="text" 
        id="name" 
        name="name" 
        required 
        minlength="2" 
        maxlength="100"
      />
    </div>
    <div>
      <label for="email">Email:</label>
      <input 
        type="email" 
        id="email" 
        name="email" 
        required 
        pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
      />
    </div>
    <button type="submit">Create User</button>
  </form>
  </MainLayout>
